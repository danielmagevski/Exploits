#!/bin/bash
#Backup de Configuracoes
#Analista: Wellington Santos
#Criado: 16/07/2007
#Modificado: 12/10/09

# Caminho dos Arquivos a serem copiados
WWW=/var/www/html
WWW_DESTINO=/var/www
JOSE=/linux/ftp/josouza/
HYLUX=/mnt/hylux/FERRARI
BACKUP=/mnt/backup/JOZOUZA_BKP

#Variaveis Globais
RSYNC=$(which rsync)
USER='root'
SERVIDOR='192.168.0.90'
DATE="`date "+%d%m%Y-%H:%M:%S"`"
LOG=/var/log/backup.log

#Parametros do Email
SENDMAIL='/sbin/sendEmail'
EMAIL='backup@sunlogica.com.br'
SENHA='2s7u6n'
EMAIL_DESTINO='suporte@tribosys.com.br'
TITULO='REVI-RIO-MANUTENCAO'
SMTP='smtp.sunlogica.com.br'
PORTA=25

#Funcao para Erro
function email_erro()
{
MENSAGEM="$HOSTNAME - OCORREU UM ERRO NA GRAVACAO DO BACKUP RSYNC - VERIFIQUE URGENTE!"
$SENDMAIL -f $EMAIL -t $EMAIL_DESTINO -u $TITULO -m "$MENSAGEM" -s $SMTP:$PORTA -xu $EMAIL -xp $SENHA
}

#Sintaxe
#Sincromismo - RSYNC
#${RSYNC} -Cravzp ${WWW} ${USER}@${SERVIDOR}:${WWW_DESTINO}
${RSYNC} -Cravzp /linux/** ${USER}@${SERVIDOR}:/backup
${RSYNC} -Cravzp /home/** ${USER}@${SERVIDOR}:/home


#################################
####### Backup no Netgear #######
#################################
#Mapea Servidor Hylux
if mount //192.168.0.92/BACKUP /mnt/hylux -o username=wellington,password=023826,fmask=0777,dmask=0777; then
	#cp -R -r -f -p ${WWW} /home /linux /opt/hylux
${RSYNC} -Cravzp ${WWW} ${HYLUX}
${RSYNC} -Cravzp /linux/** ${HYLUX}
${RSYNC} -Cravzp /home ${HYLUX}
echo " ${DATE} - Backup Netgear - Realizado com Sucesso" >> ${LOG}
else
echo " ${DATE} - Erro na Montagem do Mapeamento " >> ${LOG}
##Envia Erro
#email_erro
exit 1
fi

#Desmonta Mapeamento
if umount /mnt/hylux; then
echo "DESMONTADO - OK"
echo " ${DATE} - Mapeamento Desmontado com Sucesso! " >> ${LOG}
else
echo " ${DATE} - Erro na Desmontagem do Mapeamento " >> ${LOG}
#email_erro
exit 1
fi

####################################################
########### BACKUP ARQUIVOS SR. JOSE ###############
####################################################
if mount //192.168.0.92/backup_jose /mnt/backup -o username=wellington,password=023826,fmask=0777,dmask=0777; then

${RSYNC} -Cravzp ${JOSE} ${BACKUP}
echo " ${DATE} - Backup Netgear Sr. Jose - Realizado com Sucesso" >> ${LOG}
else
echo " ${DATE} - Erro na Montagem do Mapeamento Sr. Jose " >> ${LOG}
##Envia Erro
#email_erro
exit 1
fi

#Desmonta Mapeamento
if umount /mnt/backup; then
echo "DESMONTADO BACKUP - OK"
echo " ${DATE} - Mapeamento Desmontado com Sucesso! " >> ${LOG}
else
echo " ${DATE} - Erro na Desmontagem do Mapeamento " >> ${LOG}
#email_erro
exit 1
fi
