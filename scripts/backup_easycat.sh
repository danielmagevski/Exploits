#!/bin/bash
# Backup do Banco EASYCAT
# 05/04/2010
# Analista: Wellington Santos

# Variaveis
BANCO=Easycat.gdb
DIR_BANCO=/opt/database
DIR_BACKUP=/linux/backup/
ARQUIVO_GBK=easy_`date "+%d%m%Y%H"`.gbk
ARQUIVO=easy_`date "+%d%m%Y%H"`.tgz
ARQUIVO_DEL="easy_$(date +%d%m%Y --date='3 days ago')`date +%H`.tgz"
LOG='/var/log/backup.log'

#Parametros do Email
SENDMAIL='/sbin/sendEmail'
EMAIL='backup@sunlogica.com.br'
SENHA='2s7u6n'
EMAIL_DESTINO='suporte@tribosys.com.br'
TITULO='MANUTENCAO'
SMTP='smtp.sunlogica.com.br'
PORTA=25

#Funcao para Erro
function email_erro()
{
MENSAGEM="$HOSTNAME - OCORREU UM ERRO NA GRAVACAO DO BACKUP EASYCAT - VERIFIQUE URGENTE!"
$SENDMAIL -f $EMAIL -t $EMAIL_DESTINO -u $TITULO -m "$MENSAGEM" -s $SMTP:$PORTA -xu $EMAIL -xp $SENHA
}

#Inicia o Backup
cd $DIR_BANCO
/opt/firebird/bin/gbak -g -b -z -v $BANCO $DIR_BACKUP/$ARQUIVO_GBK -user SYSDBA -password masterkey

# COMPACTA ARQUIVO
if
        cd $DIR_BACKUP
        tar cjv $ARQUIVO_GBK -f $ARQUIVO;then
        echo " ${DATE} ${ARQUIVO} - Backup - Realizado com Sucesso" >> ${LOG}
        rm -rf $ARQUIVO_GBK
else
        echo " ${DATE} ${ARQUIVO} - Backup - Ocorreu um erro" >> ${LOG}
        email_erro
        exit 1
fi

